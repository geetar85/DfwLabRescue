@model DfwLabRescue.Web.Models.Content
@{
    ViewBag.Title = "ContentPage";
}

@section Css {
    <!-- CSS Pages Style -->
    @if (!string.IsNullOrEmpty(Model.CssFile))
    {
        <link rel="stylesheet" href="@Model.CssFile">
    }
    <link href="~/Scripts/raptor/raptor.min.css" rel="stylesheet" />
    <link href="~/Scripts/raptor/raptor-front-end.min.css" rel="stylesheet" />
    <link href="~/Content/jQuery.FileUpload/css/jquery.fileupload.css" rel="stylesheet" />
}

@if (Model.Breadcrumbs)
{
    <!--=== Breadcrumbs ===-->
    <div class="breadcrumbs">
        <div class="container">
            <h1 class="pull-left">@Model.Title</h1>
            <ul class="pull-right breadcrumb">
                <li><a href="~/">Home</a></li>
                <li class="active">@Model.Title</li>
            </ul>
        </div>
    </div><!--/breadcrumbs-->
}

<div data-id="@Model.ContentId" class="raptor">
    @Html.Raw(Model.RawHtml)
</div>


<div class="modal fade image-upload-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" style="margin-top:300px;">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="myLargeModalLabel">File Upload</h4>
            </div>
            <div class="modal-body">
                <p>Upload files to be used on content pages. Once a file has been uploaded, simply copy the relative url and use the Insert File button from the toolbar!</p>
                <span class="btn btn-success fileinput-button">
                    <i class="glyphicon glyphicon-plus"></i>
                    <span>Add files...</span>
                    <input id="fileupload" type="file" name="files" data-url="@Url.Content("~/api/imageupload")" multiple>
                </span>
                <hr />
                <ul id="uploaded-files" class="list-unstyled margin-bottom-20"></ul>
            </div>
        </div><!-- /.modal-content -->
    </div>
</div>
@section pluginJavaScript {
    <script type="text/javascript" src="~/Scripts/raptor/raptor.min.js"></script>
    <script src="~/Scripts/jQuery.FileUpload/jquery.iframe-transport.js"></script>
    <script src="~/Scripts/jQuery.FileUpload/jquery.fileupload.js"></script>
}

@section pageJavaScript {
    @if (User.Identity.IsAuthenticated)
    {
        <script type="text/javascript">
            $(function () {
                $('.raptor').raptor({
                    plugins: {
                        draggable: false,
                        dock: {
                            dockToElement: true
                        },
                        save: {
                            plugin: 'saveJson'
                        },
                        saveJson: {
                            url: '/api/Content',
                            postName: 'raptorContent',
                            id: function () {
                                return this.raptor.getElement().data('id');
                            }
                        }
                    },
                    bind: {
                        layoutShow: function () {
                            if ($('.raptor-ui-upload-file').length == 0) {
                                var insertImageEl = $('<div data-toggle="modal" data-target=".image-upload-modal" class="raptor-ui-upload-file ui-button ui-widget ui-state-default ui-button-icon-only ui-corner-right" role="button" aria-disabled="false" data-title="Upload file"><span class="ui-button-icon-primary ui-icon ui-icon-circle-plus"></span><span class="ui-button-text"></span></div>');
                                var $element = $('.raptor-ui-insert-file');
                                $element.after(insertImageEl);
                            }
                        }
                    }
                });

                $('#fileupload').fileupload({
                    dataType: 'json',
                    autoUpload: false,
                    add: function (e, data) {
                        data.context = $('<li/>').html('<h3>' + data.files[0].name + '</h3><div class="image-output"><div class="progress"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"><span class="sr-only">60% Complete</span></div></div></div>')
                            .appendTo('#uploaded-files');
                        data.submit();
                    },
                    progress: function (e, data) {
                        var progress = parseInt(data.loaded / data.total * 100, 10);
                        data.context.find('.progress-bar').css('width', progress + '%');
                        $('')
                    },
                    done: function (e, data) {
                        $.each(data.result.files, function (index, file) {
                            setTimeout(function () {
                                data.context.find('.image-output').html('<i class="fa fa-check color-green"></i> ' + file.url + '</li>');
                            }, 2000);
                        });
                    }
                });
            });

        </script>
    }
}